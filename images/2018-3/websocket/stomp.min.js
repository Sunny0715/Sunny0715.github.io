// Generated by CoffeeScript 1.7.1
/*
   Stomp Over WebSocket http://www.jmesnil.net/stomp-websocket/doc/ | Apache License V2.0

   Copyright (C) 2010-2013 [Jeff Mesnil](http://jmesnil.net/)
   Copyright (C) 2012 [FuseSource, Inc.](http://fusesource.com)
 */
(function() {
	var t,
		e,
		n,
		i,
		r = {}.hasOwnProperty,
		o = [].slice;
	t = {
		LF : "\n",
		NULL : "\x00"
	};
	n = function() {
		var e;
		function n(t, e, n) {
			this.command = t;
			this.headers = e != null ? e : {};
			this.body = n != null ? n : ""
		}
		n.prototype.toString = function() {
			var e,
				i,
				o,
				s,
				u;
			e = [ this.command ];
			o = this.headers["content-length"] === false ? true : false;
			if (o) {
				delete this.headers["content-length"]
			}
			u = this.headers;
			for (i in u) {
				if (!r.call(u, i)) continue;
				s = u[i];e.push("" + i + ":" + s)
			}
			if (this.body && !o) {
				e.push("content-length:" + n.sizeOfUTF8(this.body))
			}
			e.push(t.LF + this.body);return e.join(t.LF)
		};
		n.sizeOfUTF8 = function(t) {
			if (t) {
				return encodeURI(t).match(/%..|./g).length
			} else {
				return 0
			}
		};
		e = function(e) {
			var i,
				r,
				o,
				s,
				u,
				a,
				c,
				f,
				h,
				l,
				p,
				d,
				g,
				b,
				m,
				v,
				y;
			s = e.search(RegExp("" + t.LF + t.LF));
			u = e.substring(0, s).split(t.LF);
			o = u.shift();
			a = {};
			d = function(t) {
				return t.replace(/^\s+|\s+$/g, "")
			};
			v = u.reverse();
			for (g = 0, m = v.length; g < m; g++) {
				l = v[g];
				f = l.indexOf(":");
				a[d(l.substring(0, f))] = d(l.substring(f + 1))
			}
			i = "";
			p = s + 2;
			if (a["content-length"]) {
				h = parseInt(a["content-length"]);
				i = ("" + e).substring(p, p + h)
			} else {
				r = null;
				for (c = b = p, y = e.length; p <= y="" ?="" b="" <="" :=""> y; c = p <= y="" ?="" ++b="" :="" --b)="" {="" r="e.charAt(c);" if="" (r="==" t.null)="" break="" }="" i="" +="r" return="" new="" n(o,="" a,="" i)="" };="" n.unmarshall="function(n)" var="" i;="" function()="" r,="" o,="" s,="" u;="" s="n.split(RegExp(""" t.null="" t.lf="" "*"));="" u="[];" for="" o="s.length;" <="" o;="" r++)="" ((i="" !="null" i.length="" void="" 0)=""> 0) {
						u.push(e(i))
					}
				}
				return u
			}()
		};
		n.marshall = function(e, i, r) {
			var o;
			o = new n(e, i, r);return o.toString() + t.NULL
		};return n
	}();
	e = function() {
		var e;
		function r(t) {
			this.ws = t;
			this.ws.binaryType = "arraybuffer";
			this.counter = 0;
			this.connected = false;
			this.heartbeat = {
				outgoing : 1e4,
				incoming : 1e4
			};
			this.maxWebSocketFrameSize = 16 * 1024;
			this.subscriptions = {}
		}
		r.prototype.debug = function(t) {
			var e;
			return typeof window !== "undefined" && window !== null ? (e = window.console) != null ? e.log(t) : void 0 : void 0
		};
		e = function() {
			if (Date.now) {
				return Date.now()
			} else {
				return (new Date).valueOf
			}
		};
		r.prototype._transmit = function(t, e, i) {
			var r;
			r = n.marshall(t, e, i);
			if (typeof this.debug === "function") {
				this.debug(">>> " + r)
			}
			while (true) {
				if (r.length > this.maxWebSocketFrameSize) {
					this.ws.send(r.substring(0, this.maxWebSocketFrameSize));
					r = r.substring(this.maxWebSocketFrameSize);
					if (typeof this.debug === "function") {
						this.debug("remaining = " + r.length)
					}
				} else {
					return this.ws.send(r)
				}
			}
		};
		r.prototype._setupHeartbeat = function(n) {
			var r,
				o,
				s,
				u,
				a,
				c;
			if ((a = n.version) !== i.VERSIONS.V1_1 && a !== i.VERSIONS.V1_2) {
				return
			}
			c = function() {
				var t,
					e,
					i,
					r;
				i = n["heart-beat"].split(",");
				r = [];
				for (t = 0, e = i.length; t < e; t++) {
					u = i[t];r.push(parseInt(u))
				}
				return r
			}(), o = c[0], r = c[1];
			if (!(this.heartbeat.outgoing === 0 || r === 0)) {
				s = Math.max(this.heartbeat.outgoing, r);
				if (typeof this.debug === "function") {
					this.debug("send PING every " + s + "ms")
				}
				this.pinger = i.setInterval(s, function(e) {
					return function() {
						e.ws.send(t.LF);return typeof e.debug === "function" ? e.debug(">>> PING") : void 0
					}
				}(this))
			}
			if (!(this.heartbeat.incoming === 0 || o === 0)) {
				s = Math.max(this.heartbeat.incoming, o);
				if (typeof this.debug === "function") {
					this.debug("check PONG every " + s + "ms")
				}
				return this.ponger = i.setInterval(s, function(t) {
					return function() {
						var n;
						n = e() - t.serverActivity;
						if (n > s * 2) {
							if (typeof t.debug === "function") {
								t.debug("did not receive server activity for the last " + n + "ms")
							}
							return t.ws.close()
						}
					}
				}(this))
			}
		};
		r.prototype._parseConnect = function() {
			var t,
				e,
				n,
				i;
			t = 1 </=></=>